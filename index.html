<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Flight Price Tracker FRA â†’ FNC</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:white; text-align:center; margin:0; padding:0; }
    h1,h2 { margin: 10px; }
    .card { background:#1e1e1e; padding:20px; margin:20px auto; width:90%; max-width:800px; border-radius:10px; box-shadow: 0 0 10px #000; }
    canvas { background:#222; border-radius:10px; }
    .price { font-size:2em; font-weight:bold; }
    .green { color:#4caf50; }
    .red { color:#f44336; }
    .stats { display:flex; justify-content:space-around; margin-top:10px; }
    .stats div { text-align:center; }
    .airline { font-weight:bold; }
  </style>
</head>
<body>

<h1>Flight Price Tracker</h1>
<h2>FRA â†’ FNC (25.05 â€“ 31.05.2026)</h2>

<div class="card">
  <p>Letzter Preis pro Person: <span id="last" class="price"></span> â‚¬ <span id="trendArrow"></span></p>
  <p>Airline: <span id="airline" class="airline"></span></p>
  <div class="stats">
    <div>Durchschnitt<br><span id="avg"></span> â‚¬</div>
    <div>Min<br><span id="min"></span> â‚¬</div>
    <div>Max<br><span id="max"></span> â‚¬</div>
    <div>Ã„nderung<br><span id="pctChange"></span>%</div>
  </div>
</div>

<div class="card">
  <canvas id="chart"></canvas>
</div>

<script>
fetch("data.json")
.then(res => res.json())
.then(data => {

  const history = data.history || [];
  if(history.length === 0) return;

  // Letzter Preis
  const lastEntry = history[history.length-1];
  const lastPrice = parseFloat(lastEntry[1]);
  const lastAirline = lastEntry[2] || '';
  const prevPrice = history.length > 1 ? parseFloat(history[history.length-2][1]) : lastPrice;
  const trendUp = lastPrice > prevPrice;
  const trendArrow = trendUp ? 'ðŸ”º' : 'ðŸ”»';
  const pctChange = ((lastPrice - parseFloat(history[0][1])) / parseFloat(history[0][1]) * 100).toFixed(2);

  document.getElementById("last").innerText = lastPrice.toFixed(2);
  document.getElementById("last").className = trendUp ? 'price red' : 'price green';
  document.getElementById("trendArrow").innerText = trendArrow;
  document.getElementById("airline").innerText = lastAirline;
  document.getElementById("avg").innerText = data.average_price.toFixed(2);
  document.getElementById("min").innerText = data.min_price.toFixed(2);
  document.getElementById("max").innerText = data.max_price.toFixed(2);
  document.getElementById("pctChange").innerText = pctChange;

  // Chart Daten vorbereiten
  const labels = history.map(x => {
    const dt = new Date(x[0]);
    return dt.getDate().toString().padStart(2,'0') + '-' +
           (dt.getMonth()+1).toString().padStart(2,'0') + ' ' +
           dt.getHours().toString().padStart(2,'0') + ':' +
           dt.getMinutes().toString().padStart(2,'0');
  });
  const prices = history.map(x => parseFloat(x[1]));
  const airlines = history.map(x => x[2] || '');

  new Chart(document.getElementById("chart"), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Preis pro Person (EUR)',
        data: prices,
        borderColor: '#00bcd4',
        backgroundColor: 'rgba(0,188,212,0.2)',
        fill: true,
        tension: 0.3,
        pointRadius: 3
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          mode: 'index',
          intersect: false,
          callbacks: {
            label: function(context) {
              const airline = airlines[context.dataIndex];
              return `â‚¬${context.parsed.y.toFixed(2)} - ${airline}`;
            }
          }
        }
      },
      interaction: { mode: 'nearest', axis: 'x', intersect: false },
      scales: {
        x: { ticks: { color: 'white' } },
        y: { ticks: { color: 'white' } }
      }
    }
  });

});
</script>

</body>
</html>